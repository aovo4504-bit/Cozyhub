<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CozyHub Key</title>

<style>
    body {
        margin: 0;
        background: #0d1117;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: 'Poppins', sans-serif;
        color: white;
    }

    .card {
        width: 420px;
        background: rgba(0,0,0,0.55);
        padding: 35px 28px;
        border-radius: 25px;
        text-align: center;
        box-shadow: 0 0 55px #00eaff88;
        border: 1px solid #00eaff55;
    }

    .logo {
        width: 105px;
        height: 105px;
        background: url('https://raw.githubusercontent.com/aovo4504-bit/Cozyhub/main/IMG_0830.png') center/cover;
        margin: 0 auto 18px;
        border-radius: 50%;
        box-shadow: 0 0 25px #00eaffaa;
    }

    h1 {
        color: #00eaff;
        font-size: 30px;
        text-shadow: 0 0 12px #00eaff;
        margin-bottom: 20px;
    }

    .loader {
        margin: 0 auto 15px;
        width: 50px;
        height: 50px;
        border: 5px solid #1a252f;
        border-top: 5px solid #00eaff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg);} }

    .status {
        opacity: 0.8;
        margin-bottom: 20px;
    }

    .keybox {
        opacity: 0;
        transform: translateY(10px);
        transition: .3s;
        padding: 12px;
        font-size: 18px;
        background: rgba(0,0,0,0.55);
        border-radius: 10px;
        border: 1px solid #00eaff88;
        box-shadow: inset 0 0 18px #00eaff55;
        margin-bottom: 12px;
    }
    .keybox.show { opacity: 1; transform: translateY(0); }

    .copy-btn {
        width: 100%;
        padding: 12px 0;
        background: #00eaff;
        border: none;
        border-radius: 10px;
        font-weight: bold;
        font-size: 16px;
        cursor: pointer;
        color: #00161d;
        opacity: 0;
        transform: translateY(10px);
        transition: .3s;
    }
    .copy-btn.show { opacity: 1; transform: translateY(0); }
    .copy-btn:hover { transform: scale(1.04); }

    .msg {
        color: #59ff91;
        margin-top: 12px;
        opacity: 0;
        transition: .3s;
    }
    .msg.show { opacity: 1; }
</style>

<script>
const API_URL = "https://cozyhub.aovo4504.workers.dev";

const lang = navigator.language.startsWith("vi") ? "vi" : "en";

const TEXT = {
    loading: { vi: "Đang xử lý...", en: "Processing..." },
    copied:  { vi: "Đã copy key!", en: "Copied!" },
    reused:  { vi: "Bạn đã lấy key rồi.", en: "Key already claimed." },
    newkey:  { vi: "Key hợp lệ 24 giờ.", en: "Your key is valid for 24 hours." },
};
</script>

</head>
<body>

<div class="card">
    <div class="logo"></div>
    <h1>CozyHub Key</h1>

    <div class="loader"></div>
    <div id="status" class="status">Processing...</div>

    <div id="keybox" class="keybox">...</div>
    <button id="copy" class="copy-btn" onclick="copyKey()">COPY</button>

    <div id="msg" class="msg"></div>
</div>

<script>
async function fetchKey() {
    document.getElementById("status").textContent = TEXT.loading[lang];

    const res = await fetch(`${API_URL}/claim`);
    const json = await res.json();

    const keybox = document.getElementById("keybox");
    const copyBtn = document.getElementById("copy");
    const msg = document.getElementById("msg");

    if (json.status !== "OK") {
        keybox.textContent = "ERROR";
        keybox.classList.add("show");
        return;
    }

    keybox.textContent = json.key;
    keybox.classList.add("show");
    copyBtn.classList.add("show");

    const remaining = Math.floor((json.expire - Date.now()) / 1000);

    const h = Math.floor(remaining / 3600);
    const m = Math.floor((remaining % 3600) / 60);

    msg.innerHTML =
        (json.reused ? TEXT.reused[lang] : TEXT.newkey[lang]) +
        `<br>Còn lại: ${h} giờ ${m} phút`;

    msg.classList.add("show");
}

function copyKey() {
    const key = document.getElementById("keybox").innerText;
    navigator.clipboard.writeText(key);

    const msg = document.getElementById("msg");
    msg.textContent = TEXT.copied[lang];
    msg.classList.add("show");
}

fetchKey();
</script>

</body>
</html>
