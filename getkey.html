<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CozyHub Key</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body {
    margin:0;
    background:#050811;
    color:white;
    font-family:'Poppins',sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow:hidden;
    position:relative;
}
body::before {
    content:"";
    position:absolute;
    inset:-40%;
    background:
        radial-gradient(circle at 20% 0%, rgba(0,255,255,0.2), transparent 60%),
        radial-gradient(circle at 80% 100%, rgba(0,150,255,0.18), transparent 60%);
    filter: blur(20px);
    animation: bgMove 14s ease-in-out infinite alternate;
    z-index:-3;
}
@keyframes bgMove {
    0% { transform:scale(1); }
    100% { transform:scale(1.05) translate(3%, -3%); }
}
.card {
    width:420px;
    max-width:94vw;
    background:rgba(8,12,22,0.92);
    border-radius:26px;
    padding:35px 28px;
    text-align:center;
    box-shadow:0 0 40px rgba(0,255,255,0.35);
    border:1px solid rgba(0,255,255,0.4);
    position:relative;
}
.card::before {
    content:"";
    position:absolute;
    top:-110px; left:50%;
    width:230px; height:230px;
    background:radial-gradient(circle, rgba(0,255,255,0.55), transparent 70%);
    transform:translateX(-50%);
    filter:blur(30px);
    z-index:-2;
}
.logo {
    width:110px;height:110px;
    margin:0 auto 15px;
    background:url("https://raw.githubusercontent.com/aovo4504-bit/Cozyhub/refs/heads/main/IMG_0830.png") center/cover;
    border-radius:50%;
    box-shadow:0 0 22px cyan;
    animation: pulse 3s infinite;
}
@keyframes pulse {
    0% { box-shadow:0 0 12px cyan; }
    50% { box-shadow:0 0 28px cyan; }
    100% { box-shadow:0 0 12px cyan; }
}
h1 {
    font-size:30px;
    color:#00eaff;
    text-shadow:0 0 14px cyan;
    margin-bottom:6px;
}
.sub {
    font-size:14px;
    opacity:.8;
    margin-bottom:10px;
}
.loader {
    width:48px; height:48px;
    margin:15px auto;
    border:5px solid #123;
    border-top-color:#00eaff;
    border-radius:50%;
    animation: spin 1s linear infinite;
}
@keyframes spin { to{transform:rotate(360deg);} }
.loader.done { border-color:transparent; border-top-color:transparent; }

.keybox {
    opacity:0;
    transform:translateY(10px);
    transition:0.3s;
    background:#000;
    padding:12px;
    border-radius:12px;
    border:1px solid cyan;
    box-shadow: inset 0 0 18px rgba(0,255,255,0.45);
    word-break:break-word;
    font-size:19px;
    min-height:24px;
}
.keybox.show { opacity:1;transform:translateY(0); }

.copy-btn {
    margin-top:18px;
    padding:12px 0;
    width:100%;
    background:#00eaff;
    border:none;
    font-size:18px;
    border-radius:12px;
    font-weight:600;
    cursor:pointer;
    transform:translateY(10px);
    opacity:0;
    transition:0.25s;
    box-shadow:0 0 20px rgba(0,255,255,.6);
}
.copy-btn.show {
    opacity:1;
    transform:translateY(0);
}
.copy-btn:hover { transform:scale(1.03); }

.msg {
    margin-top:10px;
    opacity:0;
    transition:0.25s;
    font-size:14px;
}
.msg.show { opacity:1; }
.msg.ok { color:#79ffb0; }
.msg.error { color:#ff6b6b; }

.time-left {
    margin-top:10px;
    font-size:13px;
    opacity:.9;
}
.small {
    margin-top:12px;
    font-size:11px;
    opacity:.6;
}
</style>

<script>
// Ngôn ngữ mặc định: English
const LANG = "en";
const TEXT = {
  blocked:   { en:"You must complete both missions before getting your key." },
  processing:{ en:"Processing..." },
  checking:  { en:"Contacting key server..." },
  key24:     { en:"Key is valid for 24 hours." },
  already:   { en:"Key already generated earlier (showing existing key)." },
  copied:    { en:"Key copied!" },
  error:     { en:"System error, please try again." }
};

// CHẶN người chưa làm TASK1 + TASK2
function blockAccess(){
  const t1 = localStorage.getItem("cozy_task1");
  const t2 = localStorage.getItem("cozy_task2");
  if(t1!=="done" || t2!=="done"){
    document.body.innerHTML = `
      <div style="height:100vh;display:flex;justify-content:center;align-items:center;
                  background:#050811;color:white;font-size:18px;text-align:center;padding:20px;">
        ❌ ${TEXT.blocked[LANG]}
      </div>`;
    throw new Error("MISSIONS_NOT_DONE");
  }
}
blockAccess();
</script>
</head>

<body>
<div class="card">
  <div class="logo"></div>
  <h1>Cozy Hub Key</h1>
  <div class="sub" id="status">Processing...</div>

  <div id="loader" class="loader"></div>

  <div id="key" class="keybox">...</div>
  <div id="time-left" class="time-left"></div>

  <button id="copy" class="copy-btn" onclick="copyKey()">Copy Key</button>

  <div id="msg" class="msg"></div>
  <div class="small">One key per IP/HWID / 24h</div>
</div>

<script>
const REALKEY_URL = "https://cozyhub-api.aovo4504.workers.dev/realkey";

async function runGetKey(){
  const loader = document.getElementById("loader");
  const keyBox = document.getElementById("key");
  const copyBtn= document.getElementById("copy");
  const status = document.getElementById("status");
  const msg    = document.getElementById("msg");
  const timeEl = document.getElementById("time-left");

  status.textContent = TEXT.processing[LANG];
  keyBox.textContent = "...";
  keyBox.classList.remove("show");
  copyBtn.classList.remove("show");
  msg.className = "msg";

  // Nếu bạn muốn truyền thêm token cuối, có thể lấy ở đây:
  const params = new URLSearchParams(location.search);
  const token  = params.get("token") || "";

  setTimeout(async ()=>{
    status.textContent = TEXT.checking[LANG];
    try{
      const res = await fetch(REALKEY_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
          token,    // optional – server có thể bỏ qua
          hwid:""   // sau này có thể gửi HWID thật từ script Roblox/web
        })
      });

      const data = await res.json();

      if(!data.ok){
        loader.classList.add("done");
        keyBox.textContent = "ERROR";
        keyBox.classList.add("show");
        msg.textContent = data.error || TEXT.error[LANG];
        msg.className = "msg show error";
        status.textContent = "Error";
        return;
      }

      loader.classList.add("done");
      keyBox.textContent = data.key;
      keyBox.classList.add("show");
      copyBtn.classList.add("show");

      msg.textContent = data.reused ? TEXT.already[LANG] : TEXT.key24[LANG];
      msg.className   = "msg show ok";
      status.textContent = "Done.";

      const expire = data.expire;
      function updateLeft(){
        const ms = expire - Date.now();
        if(ms <= 0){
          timeEl.textContent = "Expired.";
          return;
        }
        const h = Math.floor(ms / 3600000);
        const m = Math.floor((ms % 3600000) / 60000);
        timeEl.textContent = `Time left: ${h}h ${m}m`;
      }
      updateLeft();
      setInterval(updateLeft, 60000);

    }catch(e){
      console.error(e);
      loader.classList.add("done");
      keyBox.textContent = "ERROR";
      keyBox.classList.add("show");
      msg.textContent = TEXT.error[LANG];
      msg.className = "msg show error";
      status.textContent = "Error";
    }
  }, 900);
}

function copyKey(){
  const key = document.getElementById("key").innerText.trim();
  if(!key || key==="..." || key==="ERROR") return;
  navigator.clipboard.writeText(key).then(()=>{
    const msg = document.getElementById("msg");
    msg.textContent = TEXT.copied[LANG];
    msg.className   = "msg show ok";
  });
}

runGetKey();
</script>
</body>
</html>
